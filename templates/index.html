<!doctype html>
<html>
<head>
  <meta charset='utf-8'>
  <title>Emotion Viewer - Face (3-class)</title>
  <style>
    body{font-family:Arial, sans-serif; max-width:900px;margin:20px auto;}
    video, canvas { border:1px solid #ccc; max-width:100%; }
    #result{margin-top:10px;padding:8px;background:#f6f6f6;border-radius:6px;}
  </style>
</head>
<body>
<h1>Emotion Viewer (Face-based) â€” Demo</h1>
<p>Webcam capture or image upload. Demo model predicts: <strong>Happy, Sad, Neutral</strong>.</p>

<div>
  <h3>Webcam</h3>
  <video id="video" width="400" height="300" autoplay></video><br>
  <button id="snap">Capture</button>
  <canvas id="canvas" width="400" height="300" style="display:none"></canvas>
</div>

<div>
  <h3>Upload image</h3>
  <input type="file" id="fileInput" accept="image/*">
</div>

<div id="result"></div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const snapBtn = document.getElementById('snap');
const fileInput = document.getElementById('fileInput');
const result = document.getElementById('result');

navigator.mediaDevices.getUserMedia({video:true})
  .then(stream => { video.srcObject = stream; })
  .catch(e => { console.warn('Webcam blocked or not available', e); });

function sendImage(imgDataUrl){
  result.innerText = 'Predicting...';
  fetch('/predict', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({image: imgDataUrl})})
    .then(r=>r.json()).then(data => {
      if(data.error) result.innerText = 'Error: ' + data.error;
      else {
        result.innerHTML = '<strong>Label:</strong> ' + data.label + '<br><strong>Probs:</strong> ' + JSON.stringify(data.probs);
      }
    }).catch(e=> { result.innerText = 'Error: ' + e; });
}

snapBtn.addEventListener('click', () => {
  ctx.drawImage(video, 0,0, canvas.width, canvas.height);
  const dataUrl = canvas.toDataURL('image/jpeg');
  sendImage(dataUrl);
});

fileInput.addEventListener('change', (ev)=>{
  const f = ev.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = function(e){
    sendImage(e.target.result);
  };
  reader.readAsDataURL(f);
});
</script>
</body>
</html>
